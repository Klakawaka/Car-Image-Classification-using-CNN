name: "Run tests"

on:
  push:
    branches: [ master, main ]
  pull_request:
    branches: [ master, main ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    # Checkout code
    - name: Checkout repo
      uses: actions/checkout@v6

    # Setup Python
    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: 3.12

    # Cache pip packages (your step)
    - name: Cache pip
      uses: actions/cache@v3
      with:
        path: ~/.cache/pip
        key: ${{ runner.os }}-pip-${{ hashFiles('**/uv.lock') }}
        restore-keys: |
          ${{ runner.os }}-pip-

    # Install dependencies
    - name: Install dependencies
      run: uv sync --dev --locked

    # Install your package so imports work in tests
    - name: Install package
      run: pip install -e src/

    # Optional: Lint code
    - name: Lint code
      run: |
        pip install ruff
        ruff check src/

    # Run tests
    - name: Run tests
      run: uv run pytest -v